\hypertarget{main_8c_source}{}\doxysection{main.\+c}
\label{main_8c_source}\index{src/main.c@{src/main.c}}
\mbox{\hyperlink{main_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00001}00001 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00002}00002 \textcolor{preprocessor}{\#include <sys/socket.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00003}00003 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00004}00004 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00005}00005 \textcolor{preprocessor}{\#include <pthread.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00006}00006 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00007}00007 \textcolor{preprocessor}{\#include <ncurses.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00008}00008 \textcolor{preprocessor}{\#include <form.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00009}00009 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00010}00010 \textcolor{preprocessor}{\#include <ctype.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00011}00011 \textcolor{preprocessor}{\#include <signal.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00012}00012 \textcolor{preprocessor}{\#include <sys/ioctl.h>}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{global_8c}{global.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00015}00015 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{i18n_8c}{internationalization/i18n.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00017}00017 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{error_8c}{util/error.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00018}00018 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{regex_8c}{util/regex.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00019}00019 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{util_8c}{util/util.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00021}00021 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{driver_8c}{ui/driver.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00022}00022 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{colors_8c}{ui/colors.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00024}00024 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{send_8c}{socket/send.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00025}00025 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{client_socket_8c}{socket/clientSocket.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00026}00026 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{receive_8c}{socket/receive.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00027}00027 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{ask_8c}{util/ask.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00029}00029 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{router_8c}{command/router.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00030}00030 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00031}00031 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{utils_8c}{ui/utils.c}}"{}}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00034}00034 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00040}\mbox{\hyperlink{main_8c_a57e32cd80e7f461895dc6f1c52f14f14}{00040}} \textcolor{keywordtype}{void} *\mbox{\hyperlink{main_8c_a57e32cd80e7f461895dc6f1c52f14f14}{readingLoop}}()\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00041}00041     \textcolor{keywordflow}{while}(1)\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00042}00042         \textcolor{keywordtype}{char} *message = \mbox{\hyperlink{receive_8c_ad263c3702fc55203cc98a49d21bbe01f}{receiveMessage}}();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00043}00043         \textcolor{keywordflow}{if} (\mbox{\hyperlink{regex_8c_a7e3aa9478821ab94f37a66a529cac597}{isMatch}}(message, \mbox{\hyperlink{_command_8c_aad80e827e00aa17683b9961cbc4ec63b}{commandList}}[1]-\/>regex)) \{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00044}00044             \textcolor{comment}{// If client is receiving a file from another client.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00045}00045             pthread\_t pthread;}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00046}00046             pthread\_create(\&pthread, NULL, \mbox{\hyperlink{action_threaded_8c_ab51b04f36f56ed0e7c8fba4bfd371384}{mpReceiveFileThreaded}}, message);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00047}00047         \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00048}00048         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{regex_8c_a7e3aa9478821ab94f37a66a529cac597}{isMatch}}(message, \mbox{\hyperlink{_command_8c_aad80e827e00aa17683b9961cbc4ec63b}{commandList}}[0]-\/>regex)) \{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00049}00049             \mbox{\hyperlink{send_8c_a232ae0b8d47fa481b9c67b1dfaeedf17}{sendMessage}}(\mbox{\hyperlink{global_8c_a44ccca153e1092e2cd5fc917d7470eeb}{ENDING\_MESSAGE}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00050}00050         \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00051}00051         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(strcmp(\textcolor{stringliteral}{"{}"{}}, message) != 0)\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00053}00053             \textcolor{keywordflow}{if}(\mbox{\hyperlink{regex_8c_a7e3aa9478821ab94f37a66a529cac597}{isMatch}}(message, \textcolor{stringliteral}{"{}-\/>Me : "{}}))\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00054}00054                 \textcolor{comment}{// Message received from mp.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00055}00055                 \mbox{\hyperlink{colors_8c_a2156d770d4fd316067db356d933caad6}{window\_print\_yellow}}(message);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00056}00056             \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00057}00057             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\mbox{\hyperlink{regex_8c_a7e3aa9478821ab94f37a66a529cac597}{isMatch}}(message, \textcolor{stringliteral}{"{}\string^Me : "{}}) || \mbox{\hyperlink{regex_8c_a7e3aa9478821ab94f37a66a529cac597}{isMatch}}(message, \textcolor{stringliteral}{"{}\string^Me-\/>"{}}))\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00058}00058                 \textcolor{comment}{// Message sent by the current user.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00059}00059                 \mbox{\hyperlink{colors_8c_a271daee7e3ffda060e15573011992603}{window\_print\_magenta}}(message);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00060}00060             \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00061}00061             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\mbox{\hyperlink{regex_8c_a7e3aa9478821ab94f37a66a529cac597}{isMatch}}(message, \textcolor{stringliteral}{"{}-\/>ALL : "{}}))\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00062}00062                 \textcolor{comment}{// Message received from /all.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00063}00063                 \mbox{\hyperlink{colors_8c_ae11cb1bb9d6f12d36d281e7afd20b170}{window\_print\_cyan}}(message);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00064}00064             \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00065}00065             \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00066}00066                 \textcolor{comment}{// Normal message.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00067}00067                 \mbox{\hyperlink{colors_8c_a7c806bc7b475d48823e55f8ae578ab13}{window\_print\_white}}(message);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00068}00068             \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00069}00069             refresh\_all();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00070}00070         \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00071}00071     \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00072}00072 \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00078}\mbox{\hyperlink{main_8c_a0ddf1224851353fc92bfbff6f499fa97}{00078}} \textcolor{keywordtype}{int} \mbox{\hyperlink{main_8c_a0ddf1224851353fc92bfbff6f499fa97}{main}}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[]) \{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00082}00082     \textcolor{keywordflow}{if}(\mbox{\hyperlink{global_8c_a24d2c747aa74c9920a7bb854ba7bdd26}{isDebugMode}})\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00083}00083         printf(\mbox{\hyperlink{i18n__en_8c_adb5c67286a96c662b043ba0e89868cc7}{PROGRAM\_START}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00084}00084     \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00086}00086     \textcolor{comment}{// Assigning function closeServer() to SIGTERM signal}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00087}00087     signal(SIGTERM, \mbox{\hyperlink{action_8c_a431426b48c7770349b3d0a5797f17314}{disconnectAction}});   \textcolor{comment}{// Signal shutdown from ide.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00088}00088     signal(SIGINT, \mbox{\hyperlink{action_8c_a431426b48c7770349b3d0a5797f17314}{disconnectAction}});    \textcolor{comment}{// Signal shutdown from ctr+c in terminal.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00089}00089     signal(SIGHUP, \mbox{\hyperlink{action_8c_a431426b48c7770349b3d0a5797f17314}{disconnectAction}});    \textcolor{comment}{// Signal close terminal.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00095}00095     \textcolor{comment}{// Error if the number of arguments isn't valid.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00096}00096     \textcolor{keywordflow}{if}(argc != 2)\{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00097}00097         printf(\mbox{\hyperlink{i18n__en_8c_af94c9e3c1e8a00be6cb2ab8851055473}{ERROR\_ARGS}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00098}00098         printf(\textcolor{stringliteral}{"{}\%s IP\(\backslash\)n"{}}, argv[0]);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00099}00099         exit(EXIT\_FAILURE);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00100}00100     \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00101}00101     \mbox{\hyperlink{global_8c_a77360afa4099281daa8ee4b1dca4e713}{IP}} = argv[1];}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00103}00103     \mbox{\hyperlink{_command_8c_abd3bceb28341368efbdc81ec71893dfa}{initCommandList}}();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00107}00107     printf(\mbox{\hyperlink{i18n__en_8c_a37166dd79d4cd67a60e9e9ee2d8d0f79}{WAITING\_SERVER\_CONNECTION}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00108}00108     \mbox{\hyperlink{global_8c_af3026a10afe86549e403ed46b8ff437a}{acceptedSocketDescriptor}} = \mbox{\hyperlink{client_socket_8c_a331a2d290348deac91f3e619ccf3efc8}{connectToServer}}(\mbox{\hyperlink{global_8c_a77360afa4099281daa8ee4b1dca4e713}{IP}}, \mbox{\hyperlink{global_8c_aba5431d531f986c4f7969bf01d0b452e}{CHANNEL\_DEFAULT\_PORT}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00109}00109 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00110}00110     printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0;31m"{}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00111}00111     printf(\mbox{\hyperlink{i18n__en_8c_a19eda4489c3d7541ec5b35cba29a68ba}{TERMINAL\_SIZE\_WARNING}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00112}00112     printf(\textcolor{stringliteral}{"{}\(\backslash\)033[0;37m"{}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00113}00113 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00114}00114 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00115}00115     \textcolor{comment}{// Ask user for username.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00116}00116     \textcolor{comment}{// username is a global variable.}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00117}00117     \mbox{\hyperlink{ask_8c_a6b5106d936cacb24702b93f891a86f72}{askForUsername}}();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00118}00118 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00119}00119 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00124}00124 \textcolor{comment}{// Lancer le thread de lecture}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00125}00125     pthread\_t pthread;}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00126}00126     \textcolor{keywordflow}{if} (pthread\_create(\&pthread, NULL, \mbox{\hyperlink{main_8c_a57e32cd80e7f461895dc6f1c52f14f14}{readingLoop}}, NULL)) \{}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00127}00127         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\mbox{\hyperlink{i18n__en_8c_ac65c73d8312fce3813eef9a065e1b8c6}{ERROR\_THREAD\_CREATION}}, 0);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00128}00128     \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00129}00129 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00130}00130     \textcolor{keywordtype}{int} ch;}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00131}00131 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00132}00132     interface\_init();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00133}00133 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00134}00134     signal(SIGWINCH, \mbox{\hyperlink{utils_8c_a873cf0f92f2661836d796ebc98f11b82}{resize\_window}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00135}00135 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00136}00136     wprintw(\mbox{\hyperlink{global_8c_aa9606d844c06e7bc1a543ac51f11a0ee}{win\_display}}, \textcolor{stringliteral}{"{}Hello and welcome on the chat !\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00137}00137 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00138}00138     form\_initialisation();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00139}00139 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00140}00140     \mbox{\hyperlink{router_8c_a3cbc0941b621fb4c2452f655ed953097}{doCommandAction}}(\textcolor{stringliteral}{"{}/join 3\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00141}00141     \mbox{\hyperlink{router_8c_a3cbc0941b621fb4c2452f655ed953097}{doCommandAction}}(\textcolor{stringliteral}{"{}/help\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00143}00143     refresh\_all();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00144}00144 }
\DoxyCodeLine{\Hypertarget{main_8c_source_l00145}00145     \textcolor{comment}{// Lancer le thread d'écriture}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00146}00146     \textcolor{keywordflow}{while}(1)\{ \textcolor{comment}{// Sending messages to server}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00147}00147         ch = getch();}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00148}00148         driver(ch);}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00149}00149     \}}
\DoxyCodeLine{\Hypertarget{main_8c_source_l00150}00150 \}}

\end{DoxyCode}
