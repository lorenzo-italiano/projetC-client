\hypertarget{receive_8c_source}{}\doxysection{receive.\+c}
\label{receive_8c_source}\index{src/socket/receive.c@{src/socket/receive.c}}
\mbox{\hyperlink{receive_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00007}\mbox{\hyperlink{receive_8c_a71f0b44ddd5d3f7ebfda7954438b1b5b}{00007}} \textcolor{keywordtype}{int} \mbox{\hyperlink{receive_8c_a71f0b44ddd5d3f7ebfda7954438b1b5b}{receiveMessageIntFrom}} (\textcolor{keywordtype}{int} serverSocket) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00008}00008     \textcolor{keywordtype}{int} size;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00009}00009     \textcolor{keywordtype}{int} recvInt = recv(serverSocket, \&size, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}), 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00010}00010     \textcolor{keywordflow}{if}(recvInt == -\/1)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00011}00011         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\mbox{\hyperlink{i18n__en_8c_afd4447bbba8e61ae71fcadd4e355c794}{ERROR\_RECEIVE\_MESSAGE}}, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00012}00012     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00013}00013     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(recvInt == 0)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00014}00014         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\mbox{\hyperlink{i18n__en_8c_ae472352b6bd68c4e1dca80adedf2f773}{SERVER\_CONNECTION\_CLOSED}}, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00015}00015     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00016}00016     \textcolor{keywordflow}{return} size;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00017}00017 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00025}\mbox{\hyperlink{receive_8c_a76c6cb9cb91ec56dfe2c6fa4f10cbc45}{00025}} \textcolor{keywordtype}{int} \mbox{\hyperlink{receive_8c_a76c6cb9cb91ec56dfe2c6fa4f10cbc45}{receiveMessageInt}} () \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00026}00026     \textcolor{keywordflow}{return} \mbox{\hyperlink{receive_8c_a71f0b44ddd5d3f7ebfda7954438b1b5b}{receiveMessageIntFrom}}(\mbox{\hyperlink{global_8c_af3026a10afe86549e403ed46b8ff437a}{acceptedSocketDescriptor}});}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00027}00027 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00035}\mbox{\hyperlink{receive_8c_a340d84dcdeaaac7a8a7d1bde9c1c37d6}{00035}} \textcolor{keywordtype}{char} *\mbox{\hyperlink{receive_8c_a340d84dcdeaaac7a8a7d1bde9c1c37d6}{receiveMessageStringFrom}} (\textcolor{keywordtype}{int} serverSocket, \textcolor{keywordtype}{int} messageSize) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00036}00036     \textcolor{keywordtype}{char} *message = (\textcolor{keywordtype}{char}*)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * (messageSize + 1));}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00037}00037     bzero(message, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})* (messageSize + 1));}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00039}00039     \textcolor{keywordtype}{int} sizeReceived = recv(serverSocket,message, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * messageSize, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00040}00040     \textcolor{keywordflow}{if}(sizeReceived == -\/1)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00041}00041         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\mbox{\hyperlink{i18n__en_8c_afd4447bbba8e61ae71fcadd4e355c794}{ERROR\_RECEIVE\_MESSAGE}}, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00042}00042     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00043}00043     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(sizeReceived == 0)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00044}00044         \mbox{\hyperlink{error_8c_ad5fd1194b361cfb4bc723c13d4b2182b}{throwError}}(\mbox{\hyperlink{i18n__en_8c_ae472352b6bd68c4e1dca80adedf2f773}{SERVER\_CONNECTION\_CLOSED}}, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00045}00045     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00046}00046     \textcolor{keywordflow}{return} message;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00047}00047 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00055}\mbox{\hyperlink{receive_8c_a3f1dbb921e95edf1e99a324304678f9c}{00055}} \textcolor{keywordtype}{char} *\mbox{\hyperlink{receive_8c_a3f1dbb921e95edf1e99a324304678f9c}{receiveMessageString}} (\textcolor{keywordtype}{int} messageSize) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00056}00056     \textcolor{keywordflow}{return} \mbox{\hyperlink{receive_8c_a340d84dcdeaaac7a8a7d1bde9c1c37d6}{receiveMessageStringFrom}}(\mbox{\hyperlink{global_8c_af3026a10afe86549e403ed46b8ff437a}{acceptedSocketDescriptor}}, messageSize);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00057}00057 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00062}\mbox{\hyperlink{receive_8c_a5a2c745e3990f8de71b399dcbe4e0f6d}{00062}} \textcolor{keywordtype}{char} *\mbox{\hyperlink{receive_8c_a5a2c745e3990f8de71b399dcbe4e0f6d}{receiveMessageFrom}}(\textcolor{keywordtype}{int} serverSocket)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00063}00063     \textcolor{keywordtype}{int} messageSize = \mbox{\hyperlink{receive_8c_a71f0b44ddd5d3f7ebfda7954438b1b5b}{receiveMessageIntFrom}}(serverSocket);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00064}00064     \textcolor{keywordflow}{return} \mbox{\hyperlink{receive_8c_a340d84dcdeaaac7a8a7d1bde9c1c37d6}{receiveMessageStringFrom}}(serverSocket, messageSize);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00065}00065 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00070}\mbox{\hyperlink{receive_8c_ad263c3702fc55203cc98a49d21bbe01f}{00070}} \textcolor{keywordtype}{char} *\mbox{\hyperlink{receive_8c_ad263c3702fc55203cc98a49d21bbe01f}{receiveMessage}}()\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00071}00071     \textcolor{keywordtype}{int} messageSize = \mbox{\hyperlink{receive_8c_a76c6cb9cb91ec56dfe2c6fa4f10cbc45}{receiveMessageInt}}();}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00072}00072     \textcolor{keywordflow}{return} \mbox{\hyperlink{receive_8c_a3f1dbb921e95edf1e99a324304678f9c}{receiveMessageString}}(messageSize);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00073}00073 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00081}\mbox{\hyperlink{receive_8c_a5356a63851436e180fb478c4d84ae0ad}{00081}} \textcolor{keywordtype}{void} \mbox{\hyperlink{receive_8c_a5356a63851436e180fb478c4d84ae0ad}{receiveFile}}(\textcolor{keywordtype}{int} serverFileSocket, \textcolor{keywordtype}{char} *fileName)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00082}00082     \textcolor{comment}{// Get file blocSize.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00083}00083     \textcolor{keywordtype}{long} filelen;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00084}00084     recv(serverFileSocket, \&filelen, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}), 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00086}00086     \textcolor{comment}{// Get current path.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00087}00087     \textcolor{keywordtype}{char} filePath[200];}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00088}00088     \mbox{\hyperlink{util_8c_aba1623ca3e44b15e0920f664207587c0}{getUploadDirectoryPath}}(filePath);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00089}00089     strcat(filePath, \textcolor{stringliteral}{"{}receiving/"{}});}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00090}00090     strcat(filePath, fileName);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00092}00092     \textcolor{comment}{// File creation.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00093}00093     FILE *file;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00094}00094     file = fopen(filePath, \textcolor{stringliteral}{"{}w+"{}});}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00095}00095 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00096}00096 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00097}00097     \textcolor{keywordtype}{long} blocSize = \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}};}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00098}00098     \textcolor{keywordtype}{char} subBuffer[blocSize];}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00099}00099     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < filelen; i += \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}}) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00100}00100         blocSize = (i + \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}} < filelen) ? \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}} : filelen -\/ i; \textcolor{comment}{// Calculate the bloc's blocSize.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00101}00101         recv(serverFileSocket, subBuffer, blocSize, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00102}00102         fwrite(subBuffer, blocSize, 1, file);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00103}00103         bzero(subBuffer, \mbox{\hyperlink{global_8c_a4da35cd01e3a4eb2711d8531f9fefdd7}{MAX\_SIZE\_SENT}});    \textcolor{comment}{// Clear the buffer.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00104}00104     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00105}00105 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00106}00106     fclose(file);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00107}00107 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00115}\mbox{\hyperlink{receive_8c_abad535e0f683d91516d96a033fad40be}{00115}} \textcolor{keywordtype}{int} \mbox{\hyperlink{receive_8c_abad535e0f683d91516d96a033fad40be}{receiveNewPort}} () \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00116}00116     \textcolor{keywordtype}{int} switchChannel = \mbox{\hyperlink{client_socket_8c_a331a2d290348deac91f3e619ccf3efc8}{connectToServer}}(\mbox{\hyperlink{global_8c_a77360afa4099281daa8ee4b1dca4e713}{IP}}, \mbox{\hyperlink{global_8c_ad7f270ccd216bd1f1ad29effb2dc82fa}{CHANNEL\_SWITCH\_PORT}});}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00117}00117     \textcolor{keywordtype}{int} port;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00118}00118     recv(switchChannel, \&port, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}), 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00119}00119     close(switchChannel);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00120}00120 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00121}00121     \textcolor{keywordflow}{return} port;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00122}00122 \}}

\end{DoxyCode}
