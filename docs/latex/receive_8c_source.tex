\hypertarget{receive_8c_source}{}\doxysection{receive.\+c}
\label{receive_8c_source}\index{/Users/tom/Documents/partageGit/projetC/projetC-\/client/src/socket/receive.c@{/Users/tom/Documents/partageGit/projetC/projetC-\/client/src/socket/receive.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00007}00007 \textcolor{keywordtype}{int} receiveMessageIntFrom (\textcolor{keywordtype}{int} serverSocket) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00008}00008     \textcolor{keywordtype}{int} size;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00009}00009     \textcolor{keywordtype}{int} recvInt = recv(serverSocket, \&size, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}), 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00010}00010     \textcolor{keywordflow}{if}(recvInt == -\/1)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00011}00011         throwError(ERROR\_RECEIVE\_MESSAGE, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00012}00012     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00013}00013     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(recvInt == 0)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00014}00014         throwError(SERVER\_CONNECTION\_CLOSED, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00015}00015     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00016}00016     \textcolor{keywordflow}{return} size;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00017}00017 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00025}00025 \textcolor{keywordtype}{int} receiveMessageInt () \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00026}00026     \textcolor{keywordflow}{return} receiveMessageIntFrom(acceptedSocketDescriptor);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00027}00027 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00028}00028 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00035}00035 \textcolor{keywordtype}{char} *receiveMessageStringFrom (\textcolor{keywordtype}{int} serverSocket, \textcolor{keywordtype}{int} messageSize) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00036}00036     \textcolor{keywordtype}{char} *message = (\textcolor{keywordtype}{char}*)malloc(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * (messageSize + 1));}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00037}00037     bzero(message, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})* (messageSize + 1));}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00039}00039     \textcolor{keywordtype}{int} sizeReceived = recv(serverSocket,message, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}) * messageSize, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00040}00040     \textcolor{keywordflow}{if}(sizeReceived == -\/1)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00041}00041         throwError(ERROR\_RECEIVE\_MESSAGE, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00042}00042     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00043}00043     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(sizeReceived == 0)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00044}00044         throwError(SERVER\_CONNECTION\_CLOSED, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00045}00045     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00046}00046     \textcolor{keywordflow}{return} message;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00047}00047 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00055}00055 \textcolor{keywordtype}{char} *receiveMessageString (\textcolor{keywordtype}{int} messageSize) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00056}00056     \textcolor{keywordflow}{return} receiveMessageStringFrom(acceptedSocketDescriptor, messageSize);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00057}00057 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00062}00062 \textcolor{keywordtype}{char} *receiveMessageFrom(\textcolor{keywordtype}{int} serverSocket)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00063}00063     \textcolor{keywordtype}{int} messageSize = receiveMessageIntFrom(serverSocket);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00064}00064     \textcolor{keywordflow}{return} receiveMessageStringFrom(serverSocket, messageSize);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00065}00065 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00066}00066 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00070}00070 \textcolor{keywordtype}{char} *receiveMessage()\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00071}00071     \textcolor{keywordtype}{int} messageSize = receiveMessageInt();}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00072}00072     \textcolor{keywordflow}{return} receiveMessageString(messageSize);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00073}00073 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00081}00081 \textcolor{keywordtype}{void} receiveFile(\textcolor{keywordtype}{int} serverFileSocket, \textcolor{keywordtype}{char} *fileName)\{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00082}00082     \textcolor{comment}{// Get file blocSize.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00083}00083     \textcolor{keywordtype}{long} filelen;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00084}00084     recv(serverFileSocket, \&filelen, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}), 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00085}00085 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00086}00086     \textcolor{comment}{// Get current path.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00087}00087     \textcolor{keywordtype}{char} filePath[200];}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00088}00088     getUploadDirectoryPath(filePath);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00089}00089     strcat(filePath, \textcolor{stringliteral}{"{}receiving/"{}});}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00090}00090     strcat(filePath, fileName);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00092}00092     \textcolor{comment}{// File creation.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00093}00093     FILE *file;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00094}00094     file = fopen(filePath, \textcolor{stringliteral}{"{}w+"{}});}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00095}00095 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00096}00096 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00097}00097     \textcolor{keywordtype}{long} blocSize = MAX\_SIZE\_SENT;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00098}00098     \textcolor{keywordtype}{char} subBuffer[blocSize];}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00099}00099     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < filelen; i += MAX\_SIZE\_SENT) \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00100}00100         blocSize = (i + MAX\_SIZE\_SENT < filelen) ? MAX\_SIZE\_SENT : filelen -\/ i; \textcolor{comment}{// Calculate the bloc's blocSize.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00101}00101         recv(serverFileSocket, subBuffer, blocSize, 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00102}00102         fwrite(subBuffer, blocSize, 1, file);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00103}00103         bzero(subBuffer, MAX\_SIZE\_SENT);    \textcolor{comment}{// Clear the buffer.}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00104}00104     \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00105}00105 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00106}00106     fclose(file);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00107}00107 \}}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00115}00115 \textcolor{keywordtype}{int} receiveNewPort () \{}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00116}00116     \textcolor{keywordtype}{int} switchChannel = connectToServer(IP, CHANNEL\_SWITCH\_PORT);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00117}00117     \textcolor{keywordtype}{int} port;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00118}00118     recv(switchChannel, \&port, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}), 0);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00119}00119     close(switchChannel);}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00120}00120 }
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00121}00121     \textcolor{keywordflow}{return} port;}
\DoxyCodeLine{\Hypertarget{receive_8c_source_l00122}00122 \}}

\end{DoxyCode}
